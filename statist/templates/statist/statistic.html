{% extends 'base.html' %}
{% load static %}



{% block content %}
<script src="{% static 'js/index.js' %}"></script>

<h1>Подсчет статистики:</h1>
<div class="statistic">
    <form action="{% url 'statistic:result' %}" method="post">
        {% csrf_token %}
        <div class="player_form">
        {% for field in form %}
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}



        {% endfor %}
        <span onclick="addPlayer(this)">+</span>
        <span onclick="removePlayer(this)">-</span>
        </div>

    <input type="submit" value="Подтвердить">
    </form>

</div>


<script>
    const form = document.forms[0]
    function submit(e) {
        e.preventDefault()
        let players = document.querySelectorAll('div.player')
        for ( let player of players) {
            let playerName = player.querySelector('h5').textContent
            let fields = player.querySelectorAll('input')
                for (let field of fields) {
                    let name = field.name
                    field.setAttribute('name', name + '_' + playerName)
                }

        }
        console.log(form.action)
        form.submit()

    }
    let button = document.querySelector('[type="submit"]')
    button.addEventListener('click', submit)
</script>


<script>
    let elements = document.querySelectorAll('input.count-field')
    let wrapper = document.createElement('div')
    wrapper.setAttribute('class', 'wrapper')
    for (let el of elements) {
        let wr = wrapper.cloneNode()
        el.parentNode.insertBefore(wr, el)
        wr.appendChild(el)
        el.insertAdjacentHTML('beforebegin', '<button class="minus-button" type="button">-</button>');
        el.insertAdjacentHTML('afterend', '<button class="plus-button" type="button">+</button>');
        // let bplus = document.createElement('button')
        // let bminus = document.createElement('button')
    }




    const plusButton = document.querySelectorAll(".plus-button");
    plusButton.forEach((btn) => {
            btn.addEventListener('click', (element) =>{
                let number = btn.previousElementSibling;

                number.stepUp();
                let change = new Event("change")
                number.dispatchEvent(change)

            })
        }
        )



    const minusButton = document.querySelectorAll(".minus-button");
    minusButton.forEach((btn) => {
        btn.addEventListener('click', (element) =>{
            let number = btn.nextElementSibling;

            number.stepDown();
            let change = new Event("change")
            number.dispatchEvent(change)

        })
    }
    )



</script>



{% endblock %}
